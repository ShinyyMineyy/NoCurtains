<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoCurtains</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="noise-overlay"></div>
    
    <header>
        <h1 class="logo">NoCurtains.</h1>
        <p class="subtitle">RESTRICTED ACCESS // DATABASE ENTRY</p>
    </header>

    <main>
        <nav class="tabs">
            <button class="tab-btn active" data-tab="videos">[ ARCHIVED_FOOTAGE ]</button>
            <button class="tab-btn" data-tab="pictures">[ STILL_EVIDENCE ]</button>
        </nav>

        <div id="loading" class="loading-state">SCANNING ASSETS DIRECTORY...</div>
        
        <div id="media-grid" class="grid-container hidden">
            </div>
    </main>

    <script>
        // --- 1. SET YOUR GITHUB DETAILS HERE ---
        const GITHUB_USERNAME = "YOUR_GITHUB_USERNAME"; 
        const GITHUB_REPO = "YOUR_REPOSITORY_NAME";     

        // GitHub API Endpoints for your asset folders
        const API_VIDEOS = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/assets/videos`;
        const API_PICTURES = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/assets/pictures`;

        let siteData = { videos: [], pictures: [] };
        let currentTab = 'videos';

        const gridContainer = document.getElementById('media-grid');
        const loadingState = document.getElementById('loading');
        const tabButtons = document.querySelectorAll('.tab-btn');

        async function fetchDirectory(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    // Fails gracefully if the folder doesn't exist yet
                    if(response.status === 404) return [];
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                // Filter out non-files and format the data
                return data.filter(item => item.type === 'file').map(file => {
                    // Strip the file extension for a clean title (e.g., "creepy_hallway.mp4" -> "creepy_hallway")
                    let cleanTitle = file.name.substring(0, file.name.lastIndexOf('.')) || file.name;
                    return {
                        title: cleanTitle,
                        url: file.download_url // The raw streaming link GitHub provides
                    };
                });
            } catch (error) {
                console.error("Directory fetch failed:", error);
                return [];
            }
        }

        async function initializeDatabase() {
            loadingState.classList.remove('hidden');
            gridContainer.classList.add('hidden');

            // Fetch both directories simultaneously
            const [videoData, pictureData] = await Promise.all([
                fetchDirectory(API_VIDEOS),
                fetchDirectory(API_PICTURES)
            ]);

            siteData.videos = videoData;
            siteData.pictures = pictureData;

            loadingState.classList.add('hidden');
            gridContainer.classList.remove('hidden');
            
            renderMedia(currentTab);
        }

        function renderMedia(category) {
            gridContainer.innerHTML = ''; 
            const items = siteData[category];

            if (!items || items.length === 0) {
                gridContainer.innerHTML = '<p style="color: #444; text-align: center; grid-column: 1/-1;">[ NO ASSETS FOUND IN DIRECTORY ]</p>';
                return;
            }

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'media-card';

                let mediaElement = category === 'videos' 
                    ? `<video muted loop playsinline onmouseover="this.play()" onmouseout="this.pause()"><source src="${item.url}" type="video/mp4"></video>`
                    : `<img src="${item.url}" alt="${item.title}" loading="lazy">`;

                card.innerHTML = `
                    ${mediaElement}
                    <div class="media-info">
                        <span class="media-title">${item.title}</span>
                        <span class="media-meta">FILE_ID: ${Math.floor(Math.random() * 90000) + 10000}</span>
                    </div>
                `;
                gridContainer.appendChild(card);
            });
        }

        tabButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                currentTab = e.target.getAttribute('data-tab');
                renderMedia(currentTab);
            });
        });

        // Boot up sequence
        initializeDatabase();
    </script>
</body>
</html>
